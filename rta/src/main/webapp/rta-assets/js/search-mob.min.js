function escapeHTML(e){var a="";if(null!=e&&""!=e.trim())for(var s=0;s<e.length;s++)"<"===e[s]||"%3C"===e[s]?a+="&amp;lt;":">"===e[s]||"%3E"===e[s]?a+="&amp;gt;":"'"===e[s]||"%27"===e[s]?a+="&amp;#39;":'"'===e[s]||"%27"===e[s]?a+="&amp;quot;":"/"===e[s]?a+="&amp;#47;":a+=e[s];return a}function getUrlVars(){for(var e,a=[],s=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),t=0;t<s.length;t++)e=s[t].split("="),a.push(e[0]),a[e[0]]=e[1];return a}$(document).ready(function(){window.location.href.indexOf("true")>-1&&($("#leftnav_part #show_login").css("display","none"),$("#leftnav_part #loggedin").html('<a id="show_manage_account" href="/wpsv5/wps/myportal/rta/ae/home/my-rta-account"><span>Manage<br>Account</span></a><a id="show_logout" href="/wpsv5/wps/myportal/rta/ae/home/saml/samllogout"><span>Log out</span></a>'));var e=new URL(window.location.href),a=escapeHTML(e.searchParams.get("kw")),s=!1,t=0;""!=a&&void 0!==a&&($("#searchKW-MOB").val(decodeURIComponent(a)),s=!0,t=0,i()),$("#search_part .search-autosuggest ul").empty(),$("#search_part").on("mouseleave",function(){$(".search-autosuggest").hide()}).on("mouseover",function(){$(".search-autosuggest").show()}),"undefined"==typeof permore&&(permore=5),$(".more-visible").slice(permore).hide();var r,l=$(".load-more-search");$(window).scroll(function(){$(".load-more-search").length>0&&$(window).scrollTop()+$(window).height()>=$(".load-more-search").offset().top+100&&"true"==$(".load-more-search").attr("data-load")&&($(".load-more-search").attr("loaded")||($(".load-more-search").attr("loaded",!0),l.trigger("click")))}),l.click(function(){$me=$(this),permore=$me.attr("data-id"),$(".more-visible:hidden").slice(0,permore).fadeToggle(500),0==$(".more-visible:hidden").length&&l.hide(),$(".load-more-search").attr("loaded","")}),$("#searchKW-MOB").keypress(function(e){13==e.which&&(location.href="/wps/portal/rta/ae/home/search?kw="+encodeURI($(this).val()),e.preventDefault())}),$(".sugclose").click(function(){$("#search_part .search-autosuggest").hide(),$(this).hide()});$("#searchKW-MOB, #searchServicesKW").bind("focusin",function(){$("#search_part").addClass("active")}),$("#searchKW-MOB, #searchServicesKW").bind("focusout",function(){$("#search_part").removeClass("active")}),$("#searchKW-MOB").keyup(function(){clearTimeout(r),r=setTimeout(i,1e3),!s&&t>2&&(t=0,s=!0)}),$("#searchKW-MOB").keydown(function(){clearTimeout(r)});var o=null,c=null;function i(){var e=window.location.host;e=window.location.protocol+"//"+e,$("#searchResultsLoader").show(),$("#searchResultsNone").hide(),$me=$("#searchKW-MOB"),$next=$(".load-more-search").attr("data-next");var a=escapeHTML($me.val());new Array;a.length>0?null!=o&&o.length>0?(a.length<3&&(c=null,s=!1),s?(console.log(">>google call"),h(a)):(t+=1,console.log(">>no google call"),n(a))):$.ajax({url:e+"/wps/PA_IDOS/getServicesNamesServlet?methodName=getServicesNamesWithIDs&lang=all",type:"GET",async:!0,crossDomain:!0,success:function(e){o=JSON.parse(e)}}).done(function(){a.length>3?(console.log(">>google call"),h(a)):(t+=1,console.log(">>no google call"),n(a))}):($("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;"),$("#searchResultsLoader").hide(),$(".search-result").empty(),$("#searchTags").html("<b>Please enter search keywords</b>")),$(".load-more-search").length>0&&$(".load-more-search").attr("data-load","true")}function h(e){console.log(">> google search call"),s=!1,t=0;$.ajax({type:"GET",dataType:"jsonp",url:"https://www.googleapis.com/customsearch/v1?key=AIzaSyDsHIXERHmMBuRsdV3sRkgrO00qMM1zW3c&cx=009893524337576109019:z-7gavuhcme&hl=en&cr=countryAE&safe=high&num=10&q="+e,success:function(e){console.log("1111>>response "+JSON.stringify(e)),void 0!==e.items&&(c=e.items)}}).done(function(){n(e)})}function n(a){$("#search_part .search-autosuggest ul").empty();var s=0,t=/\\/g;for(var r in o){if(8===s)break;t=new RegExp(a.trim(),"gi");var l=o[r].value,i=(o[r].label_en?o[r].label_en:"")+"<br/>"+(o[r].label_ar?o[r].label_ar:"");t=new RegExp(a.trim().toLowerCase(),"gi");i.toLowerCase().match(t)&&(s++,""!=l.trim()&&$("#search_part .search-autosuggest ul").prepend('<li><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+l.trim()+'">'+i.trim()+"</a></li>"))}if(null!=c&&""!=c)for(r=0;r<c.length;r++)s++,$("#search_part .search-autosuggest ul").append('<li><a href="'+c[r].link+'">'+c[r].htmlTitle+"</a></li>");if(s>0?$("#search_part .search-autosuggest ul").show():($("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").append("<li>No results found</li>"),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$("#searchResultsNone").show(),$("#searchResults").hide(),$("#searchResultsLoader").hide()),$(".search-result").length>0){$("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;");var h=escapeHTML(e.searchParams.get("kw"));void 0!==h&&""!=h&&null!=h||($("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$(".sugclose").show(),$("#search_part .search-autosuggest").show()),$(".search-result").empty();var n=[];for(var r in o){t=new RegExp(a.trim(),"gi"),l=o[r].value;""!=(i=(o[r].label_en?o[r].label_en:"")+"<br/>"+(o[r].label_ar?o[r].label_ar:""))&&(i=i.replace(t,"<b>$&</b>"));var u=o[r].description+"";""!=u&&(u=u.replace(t,"<b>$&</b>"));t=new RegExp(a.trim().toLowerCase(),"gi");if(i.toLowerCase().match(t)&&""!=l.trim()){var g={};g.value=l,g.label=i,g.desription=u,n.push(g)}}var d="";$("#searchResults table").html('<thead><tr><th></th></tr></thead><tbody class="search-result"></tbody>');for(var m=0;m<n.length;m++)tags="",$.each(suggestionKW2,function(e,a){var s=new RegExp(a.toLowerCase(),"gi");(n[m].desription.toLowerCase().match(s)||n[m].label.toLowerCase().match(s))&&(""!=tags&&(tags+=", "),tags+=a)}),d="RTA Portal - Directory of services: "+n[m].label.trim(),$(".search-result").prepend('<tr><td><li data-show="1" data-tag="'+tags+'"><span><a class="search-result-item" href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+n[m].value.trim()+'" class="tlink" target="_blank">'+n[m].label.trim()+"</a><br>"+d+'</span></li><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+n[m].value.trim()+'" target="_blank">www.rta.ae/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+n[m].value.trim()+"</a></td></tr>");if(null!=c&&""!=c)for(r=0;r<c.length;r++)$(".search-result").append('<tr><td><li data-show="1" data-tag=""><span><a class="search-result-item" href="'+c[r].link+'" class="tlink" target="_blank">'+c[r].htmlTitle+"</a><br>"+c[r].snippet+'</span></li><a href="'+c[r].link+'" target="_blank">'+c[r].link+"</a></td></tr>");$("#searchTags").html("<b>"+a+"</b> "+s+" results"),s>1?($("#searchTags").html("<b>"+a+"</b> "+s+" results"),$("#page-size-ddl").show(),$(window).width()>768?$.fn.DataTable.ext.pager.numbers_length=8:$.fn.DataTable.ext.pager.numbers_length=3,$("#searchResults table").DataTable({pageLength:parseInt($("#pageSizeList").find(":selected").text()),bLengthChange:!1,ordering:!1,destroy:!0,searching:!1,language:{info:"Page:  _PAGE_ of _PAGES_",paginate:{next:"Next",previous:"Previous"}}})):($("#searchTags").html("<b>"+a+"</b> "+s+" result"),$("#page-size-ddl").hide()),$("#searchResults").show(),$("#searchResultsLoader").hide()}}$("#pageSizeList").on("change",function(){$("#searchResults table").DataTable().page.len(this.value).draw()}),$(".suggestions").on("click","a",function(){$me=$(this);$(".load-more-search").attr("data-id");if($(".search-msg").html(""),$me.hasClass("active")){$(".search-result").html();$(".search-result").html(function(e,a){return a.replace(/<b>/g,"").replace(/<\/b>/g,"")}),$me.removeClass("active")}else $me.addClass("active");$kw="",$(".search-result li").hide(),$resultsvis=0,$(".suggestions li a").each(function(e,a){$c=$(this),$c.hasClass("active")&&($(".search-result span").each(function(e,a){$t=$(this);var s=$t.html(),t=new RegExp($c.html(),"gi");$t.html(s.replace(t,"<b>$&</b>"))}),""!=$kw&&($kw+=", "),$kw+=$c.html(),$(".search-result li").each(function(e,a){$t=$(this);var s=new RegExp($c.html(),"gi");$t.attr("data-tag").match(s)&&($t.show(),$resultsvis++)})),$(".suggestions-all a").removeClass("active")}),l.hide();var e=$(".search-result > li:visible").length;e>1?$("#searchTags").html("<b>"+$kw+"</b> "+e+" results"):$("#searchTags").html("<b>"+$kw+"</b> "+e+" result"),e<=0?$(".search-msg").html("Sorry! No results found."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","false"),$(".suggestions li a.active").length<=0&&$(".suggestions-all a").trigger("click")}),$(".suggestions-all a").click(function(){var e=$(".load-more-search").attr("data-id");$me=$(this),$me.addClass("active"),$(".search-result li").show(),$(".suggestions li a").each(function(e,a){$(this).removeClass("active")}),console.log(e),$(".search-result li").slice(e).hide(),l.show(),0==$(".search-result li:hidden").length&&l.hide();var a=$(".search-result > li").length;a>1?$("#searchTags").html("<b>"+$("#searchKW-MOB").val()+"</b> "+a+" results"):$("#searchTags").html("<b>"+$("#searchKW-MOB").val()+"</b> "+a+" result"),a<=0?$(".search-msg").html("Sorry! No results found."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","true")})});