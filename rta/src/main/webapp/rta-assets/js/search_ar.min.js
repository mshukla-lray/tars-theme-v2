function escapeHTML(e){var a="";if(null!=e&&""!=e.trim())for(var t=0;t<e.length;t++)"<"===e[t]||"%3C"===e[t]?a+="&amp;lt;":">"===e[t]||"%3E"===e[t]?a+="&amp;gt;":"'"===e[t]||"%27"===e[t]?a+="&amp;#39;":'"'===e[t]||"%27"===e[t]?a+="&amp;quot;":"/"===e[t]?a+="&amp;#47;":a+=e[t];return a}function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++)e=t[s].split("="),a.push(e[0]),a[e[0]]=e[1];return a}$(document).ready(function(){window.location.href.indexOf("true")>-1&&($("#leftnav_part #show_login").css("display","none"),$("#leftnav_part #loggedin").html('<a id="show_manage_account" href="/wpsv5/wps/myportal/rta/ae/home/my-rta-account"><span>Manage<br>Account</span></a><a id="show_logout" href="/wpsv5/wps/myportal/rta/ae/home/saml/samllogout"><span>Log out</span></a>'));var e=new URL(window.location.href),a=escapeHTML(e.searchParams.get("kw")),t=!1,s=0;""!=a&&void 0!==a&&($("#searchKW").val(decodeURIComponent(a)),t=!0,s=0,i()),$("#search_part .search-autosuggest ul").empty(),$("#search_part").on("mouseleave",function(){$(".search-autosuggest").hide()}).on("mouseover",function(){$(".search-autosuggest").show()}),"undefined"==typeof permore&&(permore=5),$(".more-visible").slice(permore).hide();var r,l=$(".load-more-search");$(window).scroll(function(){$(".load-more-search").length>0&&$(window).scrollTop()+$(window).height()>=$(".load-more-search").offset().top+100&&"true"==$(".load-more-search").attr("data-load")&&($(".load-more-search").attr("loaded")||($(".load-more-search").attr("loaded",!0),l.trigger("click")))}),l.click(function(){$me=$(this),permore=$me.attr("data-id"),$(".more-visible:hidden").slice(0,permore).fadeToggle(500),0==$(".more-visible:hidden").length&&l.hide(),$(".load-more-search").attr("loaded","")}),$("#searchKW").keypress(function(e){13==e.which&&(location.href="/wps/portal/rta/ae/home/search?kw="+encodeURI($(this).val()),e.preventDefault())}),$(".sugclose").click(function(){$("#search_part .search-autosuggest").hide(),$(this).hide()});$("#searchKW, #searchServicesKW").bind("focusin",function(){$("#search_part").addClass("active")}),$("#searchKW, #searchServicesKW").bind("focusout",function(){$("#search_part").removeClass("active")}),$("#searchKW").keyup(function(){clearTimeout(r),r=setTimeout(i,1e3),!t&&s>2&&(s=0,t=!0)}),$("#searchKW").keydown(function(){clearTimeout(r)});var o=null,c=null;function i(){var e=window.location.host;e=window.location.protocol+"//"+e,$("#searchResultsLoader").show(),$("#searchResultsNone").hide(),$me=$("#searchKW"),$next=$(".load-more-search").attr("data-next");var a=escapeHTML($me.val());new Array;a.length>0?null!=o&&o.length>0?(a.length<3&&(t=!1,c=null),t?(console.log(">>google call"),h(a)):(console.log(">> no google call"),s+=1,n(a))):$.ajax({url:e+"/wps/PA_IDOS/getServicesNamesServlet?methodName=getServicesNamesWithIDs&lang=all",type:"GET",async:!0,crossDomain:!0,success:function(e){o=JSON.parse(e)}}).done(function(){a.length>3?(console.log(">>google call"),h(a)):(console.log(">> no google call"),s+=1,n(a))}):($("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;"),$("#searchResultsLoader").hide(),$(".search-result").empty(),$("#searchTags").html("<b>الرجاء إدخال كلمات للبحث</b>")),$(".load-more-search").length>0&&$(".load-more-search").attr("data-load","true")}function h(e){t=!1,s=0;$.ajax({type:"GET",dataType:"jsonp",url:"https://www.googleapis.com/customsearch/v1?key=AIzaSyDsHIXERHmMBuRsdV3sRkgrO00qMM1zW3c&cx=009893524337576109019:z-7gavuhcme&hl=ar&cr=countryAE&safe=high&num=10&q="+e,success:function(e){console.log("1111>>response "+JSON.stringify(e)),void 0!==e.items&&(c=e.items)}}).done(function(){n(e)})}function n(a){var t=0,s=/\\/g;for(var r in o){if(8===t)break;s=new RegExp(a.trim(),"gi");var l=o[r].value,i=o[r].label_en?o[r].label_en:"",h=(o[r].label_ar?o[r].label_ar:"")+"<br/>"+i;s=new RegExp(a.trim().toLowerCase(),"gi");h.toLowerCase().match(s)&&(t++,""!=l.trim()&&$("#search_part .search-autosuggest ul").prepend('<li><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+l.trim()+'">'+h.trim()+"</a></li>"))}if(null!=c&&""!=c)for(r=0;r<c.length;r++)t++,$("#search_part .search-autosuggest ul").append('<li><a href="'+c[r].link+'">'+c[r].htmlTitle+"</a></li>");if($(".search-result").length>0){$("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;");var n=escapeHTML(e.searchParams.get("kw"));void 0!==n&&""!=n||($("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$(".sugclose").show(),$("#search_part .search-autosuggest").show()),$(".search-result").empty();var g=[];for(var r in o){s=new RegExp(a.trim(),"gi"),l=o[r].value,i=o[r].label_en?o[r].label_en:"";""!=(h=(o[r].label_ar?o[r].label_ar:"")+"<br/>"+i)&&(h=h.replace(s,"<b>$&</b>"));var u=o[r].description+"";""!=u&&(u=u.replace(s,"<b>$&</b>"));s=new RegExp(a.trim().toLowerCase(),"gi");if(h.toLowerCase().match(s)&&""!=l.trim()){var d={};d.value=l,d.label=h,d.desription=u,g.push(d)}}var m="";$("#searchResults table").html('<thead><tr><th></th></tr></thead><tbody class="search-result"></tbody>');for(var p=0;p<g.length;p++)tags="",$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");(g[p].desription.toLowerCase().match(t)||g[p].label.toLowerCase().match(t))&&(""!=tags&&(tags+=", "),tags+=a)}),m="هيئة الطرق و المواصلات - دليل الخدمات : "+g[p].label.trim(),$(".search-result").prepend('<tr><td><li data-show="1" data-tag="'+tags+'"><span><a class="search-result-item" href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+g[p].value.trim()+'" class="tlink" target="_blank">'+g[p].label.trim()+"</a><br>"+m+'</span></li><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+g[p].value.trim()+'" target="_blank">www.rta.ae/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+g[p].value.trim()+"</a></td></tr>");if(null!=c&&""!=c)for(r=0;r<c.length;r++)$(".search-result").append('<tr><td><li data-show="1" data-tag=""><span><a class="search-result-item" href="'+c[r].link+'" class="tlink" target="_blank">'+c[r].htmlTitle+"</a><br>"+c[r].snippet+'</span></li><a href="'+c[r].link+'" target="_blank">'+c[r].link+"</a></td></tr>");$("#searchTags").html("<b>"+a+"</b> "+t+" نتائج"),t>1?($("#searchTags").html("<b>"+a+"</b> "+t+" نتائج"),$("#page-size-ddl").show(),$(window).width()>768?$.fn.DataTable.ext.pager.numbers_length=8:$.fn.DataTable.ext.pager.numbers_length=3,$("#searchResults table").DataTable({pageLength:parseInt($("#pageSizeList").find(":selected").text()),bLengthChange:!1,ordering:!1,destroy:!0,searching:!1,language:{info:"الصفحة:  _PAGE_ من _PAGES_",paginate:{next:"التالي",previous:"السابق"}}})):($("#searchTags").html("<b>"+a+"</b> "+t+" نتيجة"),$("#page-size-ddl").hide()),$("#searchResults").show(),$("#searchResultsLoader").hide()}}$("#pageSizeList").on("change",function(){$("#searchResults table").DataTable().page.len(this.value).draw()}),$(".suggestions").on("click","a",function(){$me=$(this);$(".load-more-search").attr("data-id");if($(".search-msg").html(""),$me.hasClass("active")){$(".search-result").html();$(".search-result").html(function(e,a){return a.replace(/<b>/g,"").replace(/<\/b>/g,"")}),$me.removeClass("active")}else $me.addClass("active");$kw="",$(".search-result li").hide(),$resultsvis=0,$(".suggestions li a").each(function(e,a){$c=$(this),$c.hasClass("active")&&($(".search-result span").each(function(e,a){$t=$(this);var t=$t.html(),s=new RegExp($c.html(),"gi");$t.html(t.replace(s,"<b>$&</b>"))}),""!=$kw&&($kw+=", "),$kw+=$c.html(),$(".search-result li").each(function(e,a){$t=$(this);var t=new RegExp($c.html(),"gi");$t.attr("data-tag").match(t)&&($t.show(),$resultsvis++)})),$(".suggestions-all a").removeClass("active")}),l.hide();var e=$(".search-result > li:visible").length;e>1?$("#searchTags").html("<b>"+$kw+"</b> "+e+" نتائج"):$("#searchTags").html("<b>"+$kw+"</b> "+e+" نتيجة"),e<=0?$(".search-msg").html("نأسف! لا توجد نتائج."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","false"),$(".suggestions li a.active").length<=0&&$(".suggestions-all a").trigger("click")}),$(".suggestions-all a").click(function(){var e=$(".load-more-search").attr("data-id");$me=$(this),$me.addClass("active"),$(".search-result li").show(),$(".suggestions li a").each(function(e,a){$(this).removeClass("active")}),console.log(e),$(".search-result li").slice(e).hide(),l.show(),0==$(".search-result li:hidden").length&&l.hide();var a=$(".search-result > li").length;a>1?$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" نتائج"):$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" نتيجة"),a<=0?$(".search-msg").html("نأسف! لا توجد نتائج."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","true")})});