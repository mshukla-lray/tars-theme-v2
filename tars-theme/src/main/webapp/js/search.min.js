function getUrlVars(){for(var e,a=[],t=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),s=0;s<t.length;s++)e=t[s].split("="),a.push(e[0]),a[e[0]]=e[1];return a}$(document).ready(function(){function e(){var e=window.location.host,a=window.location.protocol;e=a+"//"+e,$("#searchResultsLoader").show(),$("#searchResultsNone").hide(),$me=$("#searchKW"),$next=$(".load-more-search").attr("data-next");var s=$me.val(),r=new Array;s.length>0?($count=0,$.ajax({url:"https://www.googleapis.com/customsearch/v1?key=AIzaSyCMGfdDaSfjqv5zYoS0mTJnOT3e9MURWkU&cx=016717179209839831092:_jnvsjx-bgs&q="+s,type:"GET",async:"true",success:function(a){if($.ajax({url:e+"/wps/PA_IDOS/getServicesNamesServlet?methodName=getServicesNamesWithIDs&lang=en",type:"GET",async:!0,crossDomain:!0,success:function(e){var a=/\\/g;jsonData=JSON.parse(e);for(var t in jsonData){var a=new RegExp(s.trim(),"gi"),r=jsonData[t].value,i=jsonData[t].label,a=new RegExp(s.trim().toLowerCase(),"gi");i.toLowerCase().match(a)&&""!=r.trim()&&$("#search_part .search-autosuggest ul").prepend('<li><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+r.trim()+'">'+i.trim()+"</a></li>")}}}),null!=a.items)if(a.items.length>0){$("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;"),$.each(a.items,function(){if($item=$(this),$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");s.length<=2?$item[0].title.toLowerCase().match(t)&&$.inArray(a,r)<0&&r.push(a):($item[0].snippet.toLowerCase().match(t)||$item[0].title.toLowerCase().match(t))&&$.inArray(a,r)<0&&r.push(a)}),s.length<=2){var e=new RegExp(s.toLowerCase(),"gi");$item[0].title.toLowerCase().match(e)&&($("#search_part .search-autosuggest ul").append('<li><a href="'+$item[0].link+'">'+$item[0].title+"</a></li>"),$count++)}else $("#search_part .search-autosuggest ul").append('<li><a href="'+$item[0].link+'">'+$item[0].title+"</a></li>"),$count++});var l=getUrlVars().kw;if(("undefined"==typeof l||""==l)&&($("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$(".sugclose").show(),$("#search_part .search-autosuggest").show()),$(".suggestions").length>0){var c=Array();$(".suggestions").empty(),r.length>0?(i=0,$.each(r,function(e,a){10>e&&$.inArray(a.toLowerCase(),c)<0&&(c.push(a),e++)})):(i=0,$.each(a.items,function(){$item=$(this),i<10&&$.inArray($item[0].title.toLowerCase(),c)<0&&(c.push($item[0].title),i++)})),$.each(c,function(e,a){$(".suggestions").append($("<li>").append($("<a>").html(a).bind("click")))})}if($(".search-result").length>0){$(".search-result").empty();var h=[];$.ajax({url:e+"/wps/PA_IDOS/getServicesNamesServlet?methodName=getServicesNamesWithIDs&lang=",type:"GET",async:!0,crossDomain:!0,success:function(e){var t=/\\/g;jsonData=JSON.parse(e);for(var r in jsonData){var t=new RegExp(s.trim(),"gi"),i=jsonData[r].value,l=jsonData[r].label;""!=l&&(l=l.replace(t,"<b>$&</b>"));var c=jsonData[r].description+"";""!=c&&(c=c.replace(t,"<b>$&</b>"));var t=new RegExp(s.trim().toLowerCase(),"gi");if(l.toLowerCase().match(t)&&""!=i.trim()){var n={};n.value=i,n.label=l,n.desription=c,h.push(n)}}for(var u="",m=0;m<h.length;m++)tags="",$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");(h[m].desription.toLowerCase().match(t)||h[m].label.toLowerCase().match(t))&&(""!=tags&&(tags+=", "),tags+=a)}),u="RTA Portal - Directory of services: "+h[m].label.trim(),$(".search-result").prepend('<li class="more-visible" data-show="1" data-tag="'+tags+'"><span><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+h[m].value.trim()+'" class="tlink" target="_blank">'+h[m].label.trim()+"</a><br>"+u+'</span><a href="/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+h[m].value.trim()+'" target="_blank">www.rta.ae/wps/portal/rta/ae/home/rta-services/service-details?serviceId='+h[m].value.trim()+"</a></li>"),$count++;$.each(a.items,function(){$item=$(this);var e="";try{null!=$item[0].pagemap.cse_image[0].src&&(e=$item[0].pagemap.cse_image[0].src)}catch(a){}if(""!=e){var t=e.substring(e.lastIndexOf(".")+1);$.inArray(t,o)<0&&(e="")}tags="",$.each(suggestionKW2,function(e,a){var t=new RegExp(a.toLowerCase(),"gi");($item[0].snippet.toLowerCase().match(t)||$item[0].title.toLowerCase().match(t))&&(""!=tags&&(tags+=", "),tags+=a)}),""!=e&&(e='<a href="'+$item[0].link+'" target="_blank"><img src="'+e+'" width="100" /></a> '),""!=tags&&(tags+=", "),tags+=$item[0].title;for(var r=!0,i=0;i<h.length;i++){var l="/wps/portal/rta/ae/home/rta-services/service-details?serviceId="+h[i].value.trim();if(h[i].label.trim()==$item[0].htmlTitle.trim()||$item[0].link.trim()==l){r=!1;break}}if(1==r)if(s.length<=2){var c=new RegExp(s.toLowerCase(),"gi");$item[0].title.toLowerCase().match(c)&&$(".search-result").append('<li class="more-visible" data-show="1" data-tag="'+tags+'">'+e+'<span><a href="'+$item[0].link+'" class="tlink" target="_blank">'+$item[0].htmlTitle+"</a><br>"+$item[0].htmlSnippet+'</span><a href="'+$item[0].link+'" target="_blank">'+$item[0].formattedUrl+"</a></li>")}else $(".search-result").append('<li class="more-visible" data-show="1" data-tag="'+tags+'">'+e+'<span><a href="'+$item[0].link+'" class="tlink" target="_blank">'+$item[0].htmlTitle+"</a><br>"+$item[0].htmlSnippet+'</span><a href="'+$item[0].link+'" target="_blank">'+$item[0].formattedUrl+"</a></li>")})}}),$("#searchTags").html("<b>"+s+"</b> "+$count+" results"),$(".more-visible").slice(permore).hide(),$count>1?$("#searchTags").html("<b>"+s+"</b> "+$count+" results"):$("#searchTags").html("<b>"+s+"</b> "+$count+" result"),$count>permore&&t.show(),$("#searchResults").show(),$("#searchResultsLoader").hide()}}else $("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").append("<li>No results found</li>"),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$("#searchResultsNone").show(),$("#searchResults").hide(),$("#searchResultsLoader").hide();else $("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").append("<li>No results found</li>"),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:10px;"),$("#searchResultsNone").show(),$("#searchResults").hide(),$("#searchResultsLoader").hide()}})):($("#search_part .search-autosuggest ul").empty(),$("#search_part .search-autosuggest ul").attr("style","padding-bottom:0px;")),$(".load-more-search").length>0&&$(".load-more-search").attr("data-load","true")}window.location.href.indexOf("true")>-1&&($("#leftnav_part #show_login").css("display","none"),$("#leftnav_part #loggedin").html('<a id="show_manage_account" href="/wpsv5/wps/myportal/rta/ae/home/my-rta-account"><span>Manage<br>Account</span></a><a id="show_logout" href="/wpsv5/wps/myportal/rta/ae/home/saml/samllogout"><span>Log out</span></a>'));var a=getUrlVars().kw;""!=a&&"undefined"!=typeof a&&($("#searchKW").val(decodeURIComponent(a)),e()),$("#search_part .search-autosuggest ul").empty(),$("#search_part").on("mouseleave",function(){$(".search-autosuggest").hide()}).on("mouseover",function(){$(".search-autosuggest").show()}),"undefined"==typeof permore&&(permore=5),$(".more-visible").slice(permore).hide();var t=$(".load-more-search");$(window).scroll(function(){$(".load-more-search").length>0&&$(window).scrollTop()+$(window).height()>=$(".load-more-search").offset().top+100&&"true"==$(".load-more-search").attr("data-load")&&($(".load-more-search").attr("loaded")||($(".load-more-search").attr("loaded",!0),t.trigger("click")))}),t.click(function(){$me=$(this),permore=$me.attr("data-id"),$(".more-visible:hidden").slice(0,permore).fadeToggle(500),0==$(".more-visible:hidden").length&&t.hide(),$(".load-more-search").attr("loaded","")}),$("#searchKW").keypress(function(e){13==e.which&&(location.href="/wps/portal/rta/ae/home/search?kw="+encodeURI($(this).val()),e.preventDefault())}),$(".sugclose").click(function(){$("#search_part .search-autosuggest").hide(),$(this).hide()});var s,r=500,o=["png","jpg","gif","jpeg"];$("#searchKW, #searchServicesKW").bind("focusin",function(){$("#search_part").addClass("active")}),$("#searchKW, #searchServicesKW").bind("focusout",function(){$("#search_part").removeClass("active")}),$("#searchKW").keyup(function(){clearTimeout(s),s=setTimeout(e,r)}),$("#searchKW").keydown(function(){clearTimeout(s)}),$(".suggestions").on("click","a",function(){$me=$(this);$(".load-more-search").attr("data-id");if($(".search-msg").html(""),$me.hasClass("active")){$(".search-result").html();$(".search-result").html(function(e,a){return a.replace(/<b>/g,"").replace(/<\/b>/g,"")}),$me.removeClass("active")}else $me.addClass("active");$kw="",$(".search-result li").hide(),$resultsvis=0,$(".suggestions li a").each(function(e,a){$c=$(this),$c.hasClass("active")&&($(".search-result span").each(function(e,a){$t=$(this);var t=$t.html(),s=new RegExp($c.html(),"gi");$t.html(t.replace(s,"<b>$&</b>"))}),""!=$kw&&($kw+=", "),$kw+=$c.html(),$(".search-result li").each(function(e,a){$t=$(this);var t=new RegExp($c.html(),"gi"),s=$t.attr("data-tag");s.match(t)&&($t.show(),$resultsvis++)})),$(".suggestions-all a").removeClass("active")}),t.hide();var e=$(".search-result > li:visible").length;e>1?$("#searchTags").html("<b>"+$kw+"</b> "+e+" results"):$("#searchTags").html("<b>"+$kw+"</b> "+e+" result"),0>=e?$(".search-msg").html("Sorry! No results found."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","false"),$(".suggestions li a.active").length<=0&&$(".suggestions-all a").trigger("click")}),$(".suggestions-all a").click(function(){var e=$(".load-more-search").attr("data-id");$me=$(this),$me.addClass("active"),$(".search-result li").show(),$(".suggestions li a").each(function(e,a){$(this).removeClass("active")}),console.log(e),$(".search-result li").slice(e).hide(),t.show(),0==$(".search-result li:hidden").length&&t.hide();var a=$(".search-result > li").length;a>1?$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" results"):$("#searchTags").html("<b>"+$("#searchKW").val()+"</b> "+a+" result"),0>=a?$(".search-msg").html("Sorry! No results found."):$(".search-msg").html(""),$(".load-more-search").attr("data-load","true")})});